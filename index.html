<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light" />
  <title>ç¾½çƒæŠ€èƒ½é—–é—œä»»å‹™</title>

  <!-- Fonts & UI -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --ink: #263159;
      --primary: #FF8F52;
      --primary-600: #FF7A3D;
      --headline: #495579;
      --paper: #FFFBEB;
      --muted: #EAEFFB;
    }
    html, body { height: 100%; }
    body {
      font-family: 'Noto Sans TC', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji', sans-serif;
      background-color: var(--paper);
      color: var(--ink);
    }
    .chart-container {
      position: relative;
      width: 100%;
      max-width: 200px;
      height: 200px;
      margin-left: auto;
      margin-right: auto;
    }
    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,.5);
      display: none; /* hidden by default */
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-overlay.open { display: flex; }
    .modal-content {
      background-color: #fff;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 25px rgba(0,0,0,.2);
      width: 90%;
      max-width: 640px;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
    }
    .close-button {
      position: absolute;
      top: 12px;
      right: 12px;
      background: none;
      border: none;
      font-size: 1.8rem;
      line-height: 1;
      cursor: pointer;
      color: var(--headline);
    }
    /* Loader */
    .loader {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: 4px solid #e5e7eb;
      border-top-color: var(--primary);
      animation: spin 1s linear infinite;
      margin: 0 auto 0.75rem;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <header class="text-center mb-10">
      <h1 class="text-4xl md:text-5xl font-bold text-[var(--headline)] mb-4">ç¾½çƒæŠ€èƒ½é—–é—œä»»å‹™å–®</h1>
      <p class="text-lg md:text-xl max-w-3xl mx-auto">è«‹èˆ‡ä½ çš„æ­æª”ä¸€èµ·å®Œæˆä»¥ä¸‹äº”å€‹é—œå¡ã€‚æ¯æ¬¡é—–é—œæ™‚è«‹éŒ„å½±ï¼Œéé—œå¾Œè«‹æˆèª²è€å¸«ç¢ºèªã€‚</p>
    </header>

    <main class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      <!-- å¡ç‰‡å…ƒä»¶ï¼šå¯è¤‡ç”¨ -->
      <section class="bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center text-center transform hover:scale-105 transition-transform duration-300">
        <h2 class="text-2xl font-bold text-[var(--headline)] mb-4">é—œå¡ä¸€ï¼šå¾Œå ´é«˜é çƒ</h2>
        <div class="chart-container mb-4">
          <canvas id="chart1" aria-label="å¾Œå ´é«˜é çƒç›®æ¨™æ¬¡æ•¸åœ–è¡¨" role="img"></canvas>
        </div>
        <div class="flex-grow flex flex-col justify-between w-full">
          <div>
            <h3 class="font-bold text-lg mb-1">ç›®æ¨™</h3>
            <p class="mb-4">åœ¨å¾Œå ´å°‡çƒæ‰“é«˜ï¼Œè®“çƒé£›éå°æ‰‹é ­é ‚ï¼Œè½åœ¨å°æ–¹å¾Œå ´å€åŸŸã€‚</p>
            <h3 class="font-bold text-lg mb-1">åŸ·è¡Œæ–¹å¼</h3>
            <p>èˆ‡æ­æª”ç«™åœ¨å ´åœ°å…©ç«¯åº•ç·šé™„è¿‘ï¼Œé€£çºŒ <span class="text-3xl font-bold text-[var(--primary)]">5</span> æ¬¡æˆåŠŸå°‡çƒæ‰“åˆ°å¾Œå ´å€åŸŸå³å¯éé—œã€‚</p>
          </div>
          <button class="mt-6 px-6 py-3 bg-[var(--primary)] text-white font-bold rounded-full shadow-md hover:bg-[var(--primary-600)] transition-colors duration-300" onclick="showExplanation('å¾Œå ´é«˜é çƒ')">âœ¨ èªªæ˜è¡“èª</button>
        </div>
      </section>

      <section class="bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center text-center transform hover:scale-105 transition-transform duration-300">
        <h2 class="text-2xl font-bold text-[var(--headline)] mb-4">é—œå¡äºŒï¼šç¶²å‰æ”¾çƒ</h2>
        <div class="chart-container mb-4">
          <canvas id="chart2" aria-label="ç¶²å‰æ”¾çƒç›®æ¨™æ¬¡æ•¸åœ–è¡¨" role="img"></canvas>
        </div>
        <div class="flex-grow flex flex-col justify-between w-full">
          <div>
            <h3 class="font-bold text-lg mb-1">ç›®æ¨™</h3>
            <p class="mb-4">ç·´ç¿’æ§åˆ¶çƒçš„åŠ›é“ï¼Œè®“çƒè¼•æŸ”åœ°é£›éç¶²å­ï¼Œè½åœ¨ç¶²å‰å€åŸŸã€‚</p>
            <h3 class="font-bold text-lg mb-1">åŸ·è¡Œæ–¹å¼</h3>
            <p>èˆ‡æ­æª”ç«™åœ¨ç¶²å‰ï¼Œå°‡çƒè¼•è¼•æ¨éç¶²ï¼Œé€£çºŒ <span class="text-3xl font-bold text-[var(--primary)]">5</span> æ¬¡æˆåŠŸè®“çƒè½åœ¨ç¶²å‰ 1 å…¬å°ºçš„å€åŸŸå…§å³å¯éé—œã€‚</p>
          </div>
          <button class="mt-6 px-6 py-3 bg-[var(--primary)] text-white font-bold rounded-full shadow-md hover:bg-[var(--primary-600)] transition-colors duration-300" onclick="showExplanation('ç¶²å‰æ”¾çƒ')">âœ¨ èªªæ˜è¡“èª</button>
        </div>
      </section>

      <section class="bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center text-center transform hover:scale-105 transition-transform duration-300">
        <h2 class="text-2xl font-bold text-[var(--headline)] mb-4">é—œå¡ä¸‰ï¼šæ®ºçƒç·´ç¿’</h2>
        <div class="chart-container mb-4">
          <canvas id="chart3" aria-label="æ®ºçƒç·´ç¿’ç›®æ¨™æ¬¡æ•¸åœ–è¡¨" role="img"></canvas>
        </div>
        <div class="flex-grow flex flex-col justify-between w-full">
          <div>
            <h3 class="font-bold text-lg mb-1">ç›®æ¨™</h3>
            <p class="mb-4">å­¸ç¿’æ®ºçƒçš„æ®æ‹å‹•ä½œå’Œå‘ä¸‹ç™¼åŠ›ã€‚</p>
            <h3 class="font-bold text-lg mb-1">åŸ·è¡Œæ–¹å¼</h3>
            <p>æ­æª”å°‡çƒæ‹‹åˆ°ä½ é ­é ‚ä¸Šæ–¹ï¼Œä½ è·³èµ·ä¸¦ç”¨åŠ›å°‡çƒå‘ä¸‹æ‰“å‡ºï¼Œé€£çºŒ <span class="text-3xl font-bold text-[var(--primary)]">3</span> æ¬¡æˆåŠŸå°‡çƒæ‰“åˆ°å°é¢å ´åœ°å³å¯éé—œã€‚</p>
          </div>
          <button class="mt-6 px-6 py-3 bg-[var(--primary)] text-white font-bold rounded-full shadow-md hover:bg-[var(--primary-600)] transition-colors duration-300" onclick="showExplanation('æ®ºçƒç·´ç¿’')">âœ¨ èªªæ˜è¡“èª</button>
        </div>
      </section>

      <section class="bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center text-center transform hover:scale-105 transition-transform duration-300 md:col-span-2 lg:col-span-1 lg:col-start-2">
        <h2 class="text-2xl font-bold text-[var(--headline)] mb-4">é—œå¡å››ï¼šåŸºç¤å°æ‰“</h2>
        <div class="chart-container mb-4">
          <canvas id="chart4" aria-label="åŸºç¤å°æ‰“ç›®æ¨™æ¬¡æ•¸åœ–è¡¨" role="img"></canvas>
        </div>
        <div class="flex-grow flex flex-col justify-between w-full">
          <div>
            <h3 class="font-bold text-lg mb-1">ç›®æ¨™</h3>
            <p class="mb-4">åŸ¹é¤ŠåŸºæœ¬çš„å›æ“Šèƒ½åŠ›å’Œå”èª¿æ€§ã€‚</p>
            <h3 class="font-bold text-lg mb-1">åŸ·è¡Œæ–¹å¼</h3>
            <p>èˆ‡æ­æª”åœ¨å ´åœ°ä¸­å¤®é™„è¿‘ï¼Œä»¥è¼•é¬†çš„åŠ›é“å°‡çƒä¾†å›å°æ‰“ï¼Œé€£çºŒ <span class="text-3xl font-bold text-[var(--primary)]">10</span> æ¬¡ä¾†å›ä¸è½åœ°å³å¯éé—œã€‚</p>
          </div>
          <button class="mt-6 px-6 py-3 bg-[var(--primary)] text-white font-bold rounded-full shadow-md hover:bg-[var(--primary-600)] transition-colors duration-300" onclick="showExplanation('åŸºç¤å°æ‰“')">âœ¨ èªªæ˜è¡“èª</button>
        </div>
      </section>

      <section class="bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center text-center transform hover:scale-105 transition-transform duration-300 md:col-start-1 md:col-end-3 lg:col-start-auto lg:col-end-auto">
        <h2 class="text-2xl font-bold text-[var(--headline)] mb-4">é—œå¡äº”ï¼šç±³å­—æ­¥æ³•</h2>
        <div class="chart-container mb-4">
          <canvas id="chart5" aria-label="ç±³å­—æ­¥æ³•æ™‚é–“åœ–è¡¨" role="img"></canvas>
        </div>
        <div class="flex-grow flex flex-col justify-between w-full">
          <div>
            <h3 class="font-bold text-lg mb-1">ç›®æ¨™</h3>
            <p class="mb-4">ç†Ÿæ‚‰ç¾½çƒå ´ä¸Šå„å€‹ä½ç½®çš„ç§»å‹•è…³æ­¥ã€‚</p>
            <h3 class="font-bold text-lg mb-1">åŸ·è¡Œæ–¹å¼</h3>
            <p>åœ¨å ´åœ°ä¸­å¤®ï¼Œä¾åºå‘å…«å€‹æ–¹å‘ç§»å‹•ä¸¦å›åˆ°ä¸­å¿ƒï¼Œåœ¨ <span class="text-3xl font-bold text-[var(--primary)]">60</span> ç§’å…§æˆåŠŸå®Œæˆä¸€å€‹å®Œæ•´çš„å¾ªç’°å³å¯éé—œã€‚</p>
          </div>
          <button class="mt-6 px-6 py-3 bg-[var(--primary)] text-white font-bold rounded-full shadow-md hover:bg-[var(--primary-600)] transition-colors duration-300" onclick="showExplanation('ç±³å­—æ­¥æ³•')">âœ¨ èªªæ˜è¡“èª</button>
        </div>
      </section>
    </main>
  </div>

  <!-- Modal -->
  <div id="explanationModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-content">
      <button class="close-button" aria-label="é—œé–‰" onclick="closeModal()">&times;</button>
      <h2 id="modalTitle" class="text-3xl font-bold text-[var(--headline)] mb-4"></h2>
      <div id="modalBody">
        <p id="modalContent" class="text-base leading-relaxed"></p>
        <div id="modalLoading" class="text-center mt-4 hidden">
          <div class="loader" aria-hidden="true"></div>
          <div class="text-[var(--headline)]">è¼‰å…¥ä¸­â€¦</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // -------------------------------
    // Chart.js center text plugin
    // -------------------------------
    const centerTextPlugin = {
      id: 'centerText',
      afterDraw: (chart) => {
        const { ctx, canvas, chartArea } = chart;
        if (!chartArea) return; // Guard for animations not finished
        const centerX = (chartArea.left + chartArea.right) / 2;
        const centerY = (chartArea.top + chartArea.bottom) / 2;
        const text = chart.options.plugins.centerText?.text ?? '';
        const unit = chart.options.plugins.centerText?.unit ?? '';

        ctx.save();
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.font = "bold 48px 'Noto Sans TC'";
        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--primary').trim() || '#FF8F52';
        ctx.fillText(String(text), centerX, centerY - 10);

        ctx.font = "bold 18px 'Noto Sans TC'";
        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--headline').trim() || '#495579';
        ctx.fillText(String(unit), centerX, centerY + 28);
        ctx.restore();
      }
    };
    Chart.register(centerTextPlugin);

    function createChallengeChart(canvasId, targetNumber, unit) {
      const el = document.getElementById(canvasId);
      if (!el) return;
      const ctx = el.getContext('2d');
      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: [unit, ''],
          datasets: [{
            data: [targetNumber, 0.0001],
            backgroundColor: ['#FF8F52', '#EAEFFB'],
            borderColor: '#ffffff',
            borderWidth: 4,
            hoverBorderColor: '#ffffff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '80%',
          plugins: {
            legend: { display: false },
            tooltip: { enabled: false },
            centerText: { text: targetNumber, unit }
          }
        }
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      createChallengeChart('chart1', 5, 'æ¬¡');
      createChallengeChart('chart2', 5, 'æ¬¡');
      createChallengeChart('chart3', 3, 'æ¬¡');
      createChallengeChart('chart4', 10, 'æ¬¡');
      createChallengeChart('chart5', 60, 'ç§’');

      // å…è¨± ESC é—œé–‰è¦–çª—
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });
      // é»æ“Šé®ç½©é—œé–‰
      document.getElementById('explanationModal').addEventListener('click', (e) => {
        if (e.target.id === 'explanationModal') closeModal();
      });
    });

    // -------------------------------
    // Modal helpers
    // -------------------------------
    const explanationModal = document.getElementById('explanationModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalContent = document.getElementById('modalContent');
    const modalLoading = document.getElementById('modalLoading');

    function openModal() { explanationModal.classList.add('open'); }
    function closeModal() {
      explanationModal.classList.remove('open');
      modalTitle.textContent = '';
      modalContent.textContent = '';
      modalLoading.classList.add('hidden');
    }

    // å°‡ç¼ºå¤±çš„ showExplanation() æ¥ä¸Š API å‘¼å«
    function showExplanation(term) {
      callGeminiAPI(term);
    }

    // -------------------------------
    // Gemini API å‘¼å« + æœ¬åœ°å‚™æ´è©å½™
    // -------------------------------
    const LOCAL_GLOSSARY = {
      'å¾Œå ´é«˜é çƒ': 'é«˜é çƒæ˜¯å¾å¾Œå ´å°‡çƒé«˜å¼§åº¦æ‰“å‘å°æ–¹å¾Œå ´çš„åŸºæœ¬æŠ€è¡“ã€‚é‡é»æ˜¯æº–å‚™å§¿å‹¢è¦å´èº«ã€å¼•æ‹å®Œæ•´ã€æ“Šçƒé»åœ¨èº«é«”å‰ä¸Šæ–¹ï¼Œå‡ºæ‹æ™‚æ‰‹è‡‚æ”¾é¬†åŠ ä¸Šèº«é«”è½‰å‹•ã€‚ç·´ç¿’æ™‚æƒ³åƒæŠŠçƒã€Œé€ä¸Šå»ã€é€åˆ°é æ–¹ã€ã€‚',
      'ç¶²å‰æ”¾çƒ': 'æ”¾å°çƒéœ€è¦ç´°è†©æ‰‹æ„Ÿã€‚çƒæ‹é¢è¦ç©©ã€åŠ›é‡å°è€Œé€£çºŒï¼Œè®“çƒè²¼ç¶²ä¸‹å¢œã€‚æ“Šçƒé»é€šå¸¸åœ¨èƒ¸å£åˆ°è‚©è†€ä¹‹é–“ã€é è¿‘ç¶²å¸¶ä½ç½®ã€‚ç·´ç¿’æ™‚å¯å…ˆå›ºå®šè…³æ­¥ï¼Œå°ˆæ³¨æ‹é¢è§’åº¦èˆ‡è§¸çƒæ™‚é–“ã€‚',
      'æ®ºçƒç·´ç¿’': 'æ®ºçƒæ˜¯å‘ä¸‹çš„é€²æ”»çƒã€‚é‡é»æ˜¯æŠ¬è‚˜å¼•æ‹ã€èº«é«”å‘å‰ä¸Šæ–¹å»¶ä¼¸ï¼Œæ“Šçƒé»åœ¨æœ€é«˜é»ç¨å‰æ–¹ï¼Œè½åœ°è¦æœ‰ç·©è¡ã€‚å…ˆå­¸ã€Œå¿«ã€æº–ã€ç©©ã€ï¼Œå†è¿½æ±‚ã€Œé‡ã€ã€‚',
      'åŸºç¤å°æ‰“': 'åŸºç¤å°æ‰“å¼·èª¿ç¯€å¥èˆ‡ç©©å®šã€‚ç”¨ä¸ƒæˆåŠŸåŠ›ã€çƒéä¸­ç·šå³å›ï¼Œå°ˆæ³¨æ–¼æ­¥ä¼åˆ°ä½ã€æ‹é¢ç©©ã€è½é»æ¸…æ¥šã€‚å¯è¨­å®šã€Œä¸€é«˜ä¸€å¹³ã€çš„ç¯€å¥å…ˆå»ºç«‹ç©©å®šåº¦ã€‚',
      'ç±³å­—æ­¥æ³•': 'ç±³å­—æ­¥æ³•æ¨¡æ“¬å ´ä¸Šå…«æ–¹å‘ç§»å‹•ï¼ˆå‰ã€å¾Œã€å·¦ã€å³èˆ‡å››å€‹æ–œç·šï¼‰ã€‚é—œéµæ˜¯èµ·å‹•å¿«ã€æœ€å¾Œå…©æ­¥å°ç¢æ­¥èª¿æ•´åˆ°ä½ã€å›ä¸­ç«‹ä½æ™‚èº«é«”é‡å¿ƒä¿æŒåœ¨å‰è…³æŒã€‚å¯æ­é…ç¯€æ‹å™¨è¨“ç·´ç¯€å¥ã€‚'
    };

    async function callGeminiAPI(term) {
      openModal();
      modalTitle.textContent = `ã€Œ${term}ã€èªªæ˜`;
      modalContent.textContent = '';
      modalLoading.classList.remove('hidden');

      const systemPrompt = 'ä½ æ˜¯ä¸€ä½å°ˆæ¥­ä¸”è€å¿ƒå‹å–„çš„ç¾½çƒæ•™ç·´ï¼Œè«‹ç”¨ç°¡å–®æ˜“æ‡‚çš„æ–¹å¼ï¼Œç‚ºç¾½çƒåˆå­¸è€…è§£é‡‹ä»¥ä¸‹è¡“èªã€‚è«‹é¿å…ä½¿ç”¨éæ–¼å°ˆæ¥­çš„è¡“èªï¼Œä¸¦æä¾›å¯¦éš›çš„å»ºè­°æˆ–æƒ³åƒï¼Œè®“ä»–å€‘èƒ½è¼•é¬†ç†è§£ã€‚';
      const userQuery = `è«‹è§£é‡‹ã€Œ${term}ã€é€™å€‹ç¾½çƒè¡“èªã€‚`;

      // ğŸ‘‰ åœ¨æ­¤å¡«å…¥ä½ çš„ Gemini API Keyï¼ˆå¯ç•™ç©ºæ”¹ç”¨æœ¬åœ°å‚™æ´ï¼‰
      const apiKey = '';
      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

      // è‹¥æœªè¨­å®š API Keyï¼Œä½¿ç”¨æœ¬åœ°å‚™æ´èªªæ˜
      if (!apiKey) {
        await new Promise(r => setTimeout(r, 300)); // å°å»¶é²è¼ƒæœ‰äº’å‹•æ„Ÿ
        modalContent.textContent = LOCAL_GLOSSARY[term] || 'ç›®å‰ç„¡æ­¤è¡“èªçš„é è¨­èªªæ˜ï¼Œè«‹å‘è€å¸«æå•æˆ–ç¨å¾Œå†è©¦ã€‚';
        modalLoading.classList.add('hidden');
        return;
      }

      const payload = {
        contents: [{ parts: [{ text: userQuery }] }],
        systemInstruction: { parts: [{ text: systemPrompt }] }
      };

      let retryDelay = 800;
      const maxRetries = 4;
      for (let i = 0; i < maxRetries; i++) {
        try {
          const resp = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          if (resp.status === 429) {
            await new Promise(r => setTimeout(r, retryDelay));
            retryDelay *= 2; // æŒ‡æ•¸é€€é¿
            continue;
          }

          if (!resp.ok) {
            const err = await resp.json().catch(() => ({}));
            throw new Error(`API éŒ¯èª¤ï¼š${resp.status}${err?.error?.message ? ' - ' + err.error.message : ''}`);
          }

          const data = await resp.json();
          const text = data?.candidates?.[0]?.content?.parts?.[0]?.text;
          modalContent.textContent = text || (LOCAL_GLOSSARY[term] ?? 'æŠ±æ­‰ï¼Œç„¡æ³•å–å¾—èªªæ˜å…§å®¹ã€‚');
          break;
        } catch (e) {
          // æœ€å¾Œä¸€æ¬¡å¤±æ•—æ”¹ç”¨æœ¬åœ°å‚™æ´
          if (i === maxRetries - 1) {
            modalContent.textContent = LOCAL_GLOSSARY[term] || `æŠ±æ­‰ï¼Œè¼‰å…¥å¤±æ•—ï¼š${e.message}`;
          } else {
            await new Promise(r => setTimeout(r, retryDelay));
            retryDelay *= 2;
          }
        }
      }
      modalLoading.classList.add('hidden');
    }
  </script>
</body>
</html>
