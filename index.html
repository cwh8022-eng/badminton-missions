<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç¾½çƒæŠ€èƒ½é—–é—œä»»å‹™ï¼ˆæ¡ç”¨è»Ÿå¼ç¶²çƒè¨­è¨ˆåŸç†ï¼‰</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --ink: #263159;
      --primary: #FF8F52;
      --headline: #495579;
      --paper: #FFFDF7;
      --success: #16a34a;
      --danger: #ef4444;
      --accent: #8b5cf6;
    }
    body { background: var(--paper); color: var(--ink); }
    .card { background:#fff; border-radius: 1rem; box-shadow: 0 8px 24px rgba(0,0,0,.08); }

    /* å®Œæˆå°ç« ï¼ˆæ²¿ç”¨è¨­è¨ˆåŸç†ï¼‰ */
    .stamp-wrap { position: relative; }
    .stamp-svg {
      position:absolute; top:-10px; left:50%; transform:translateX(-50%) rotate(-8deg) scale(0.2);
      width:120px; height:120px; opacity:0; pointer-events:none;
      filter: drop-shadow(0 4px 6px rgba(0,0,0,.2));
    }
    .stamp-bounce { animation: stampIn .7s ease-out forwards; }
    @keyframes stampIn {
      0% { transform:translateX(-50%) rotate(-8deg) scale(0.2); opacity:0; }
      60% { transform:translateX(-50%) rotate(-6deg) scale(1.15); opacity:1; }
      100% { transform:translateX(-50%) rotate(-8deg) scale(1); opacity:1; }
    }

    /* Modal */
    .modal { position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; z-index:50; }
    .modal.show { display:flex; }
    .modal-card { width: min(960px, 92vw); background:#fff; border-radius:1rem; box-shadow:0 10px 30px rgba(0,0,0,.18); }
    .modal-header { display:flex; justify-content:space-between; align-items:center; padding:14px 18px; border-bottom:1px solid #eee; }
    .close-x { font-size:20px; font-weight:700; cursor:pointer; }
    .modal-body { padding:0; }

    /* å¾½ç«  */
    .badge { display:inline-flex; align-items:center; gap:.5rem; padding:.4rem .75rem; border-radius:999px; font-weight:700; }
    .badge-silver { background:#eef2ff; border:2px solid #c7d2fe; }
    .badge-gold { background:#fff7e6; border:2px solid #facc15; }
    .badge-trophy { background:#fff1f2; border:2px solid #fb7185; }

    /* é‡‘è‰²çç›ƒå‹•ç•« */
    .trophy-wrap { position:fixed; left:50%; top:-40vh; transform:translateX(-50%); z-index:60; pointer-events:none; display:none; }
    .trophy-wrap.show { display:block; animation: dropIn 1s ease-out forwards, glow 2s ease-in-out 1s infinite alternate; }
    @keyframes dropIn { 0% { top:-40vh; } 80% { top:15vh; } 100% { top:18vh; } }
    @keyframes glow { from { filter: drop-shadow(0 0 0 rgba(250, 204, 21, .8)); } to { filter: drop-shadow(0 0 18px rgba(250, 204, 21, 1)); } }

    /* å°å·¥å…· */
    .btn { padding:.6rem 1rem; border-radius:.75rem; font-weight:700; }
    .btn-green { background:var(--success); color:#fff; }
    .btn-purple { background:var(--accent); color:#fff; }
    .btn-red { background:var(--danger); color:#fff; }
    .btn-ghost { background:#f3f4f6; }
    .teacher-badge { background:#ede9fe; color:#5b21b6; border:1px dashed #a78bfa; }
  </style>
</head>
<body class="min-h-screen">
  <!-- é‡‘è‰²çç›ƒ -->
  <div id="trophy" class="trophy-wrap" aria-hidden="true">
    <svg width="220" height="220" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
      <defs><linearGradient id="g" x1="0" x2="0" y1="0" y2="1"><stop offset="0%" stop-color="#facc15"/><stop offset="100%" stop-color="#eab308"/></linearGradient></defs>
      <g fill="url(#g)" stroke="#92400e" stroke-width="1">
        <path d="M12 8h40v6a14 14 0 0 1-14 14H26A14 14 0 0 1 12 14z"/>
        <path d="M16 8v-4h32v4z"/>
        <rect x="28" y="28" width="8" height="8" rx="1"/>
        <rect x="24" y="36" width="16" height="6" rx="1"/>
        <rect x="20" y="42" width="24" height="6" rx="1"/>
        <rect x="16" y="48" width="32" height="6" rx="1"/>
      </g>
      <circle cx="32" cy="19" r="7" fill="#fde68a" opacity=".7"/>
    </svg>
  </div>

  <!-- é é¦– -->
  <header class="text-center px-4 py-6">
    <h1 class="text-3xl md:text-4xl font-extrabold text-[var(--headline)]">ç¾½çƒæŠ€èƒ½é—–é—œä»»å‹™å–®</h1>
    <p class="text-sm text-gray-600 mt-2">ç™»å…¥å¾Œé–‹å§‹é—–é—œ â€” å®Œæˆæ¯ä¸€é—œè¼¸å…¥å¯†ç¢¼ <b>888</b> å–å¾—å®Œæˆå°ç« ï¼</p>
  </header>

  <!-- ç™»å…¥å€ -->
  <section id="loginSection" class="max-w-xl card mx-auto p-6 my-6">
    <div class="flex items-center justify-between">
      <h2 class="text-xl font-bold">å­¸ç”Ÿç™»å…¥</h2>
      <span id="modePill" class="badge teacher-badge hidden">æ•™å¸«æ¨¡å¼</span>
    </div>
    <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-3">
      <input id="studentId" class="border rounded-lg p-3" placeholder="å­¸è™Ÿ" />
      <input id="studentName" class="border rounded-lg p-3" placeholder="å§“å" />
    </div>
    <div class="mt-4 flex gap-3">
      <button class="btn btn-green" onclick="login()">ç™»å…¥</button>
      <button class="btn btn-ghost" onclick="toggleTeacherMode()">åˆ‡æ›æ•™å¸«æ¨¡å¼</button>
    </div>
    <p class="text-xs text-gray-500 mt-3">æç¤ºï¼šæ•™å¸«æ¨¡å¼å¯æŸ¥çœ‹æ’è¡Œæ¦œèˆ‡ç¸½è¦½ï¼Œç”¨æ–¼èª²å ‚å±•ç¤ºã€‚</p>
  </section>

  <!-- ä¸»å…§å®¹ -->
  <main id="app" class="container mx-auto px-4 pb-20 hidden">
    <!-- æ§åˆ¶åˆ— -->
    <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
      <div class="flex items-center gap-2">
        <span id="helloText" class="font-bold"></span>
        <span id="modePill2" class="badge teacher-badge hidden">æ•™å¸«æ¨¡å¼</span>
      </div>
      <div class="flex gap-2">
        <button class="btn btn-purple" onclick="openLeaderboard()">æ’è¡Œæ¦œ</button>
        <button class="btn btn-red" onclick="logout()">ç™»å‡º</button>
      </div>
    </div>

    <!-- é€²åº¦ç¸½è¦½ï¼ˆ5 é—œï¼‰ -->
    <section class="card p-4 mb-6">
      <div class="grid grid-cols-1 md:grid-cols-3 items-center gap-4">
        <div class="justify-self-center">
          <canvas id="overallChart" width="220" height="220" aria-label="ç¸½é€²åº¦åœ–" role="img"></canvas>
        </div>
        <div class="md:col-span-2">
          <h3 class="text-xl font-bold mb-2">å€‹äººé€²åº¦</h3>
          <p id="overallText" class="text-sm text-gray-700 mb-3">å·²å®Œæˆ 0/5 (0%)</p>
          <div class="flex flex-wrap gap-2 items-center">
            <span id="badge3" class="badge badge-silver hidden">ğŸ¥ˆ éŠ€ç‰Œï¼ˆ3/5ï¼‰</span>
            <span id="badge4" class="badge badge-gold hidden">ğŸ¥‡ é‡‘ç‰Œï¼ˆ4/5ï¼‰</span>
            <span id="badge5" class="badge badge-trophy hidden">ğŸ† å…¨éƒ¨å®Œæˆï¼ˆ5/5ï¼‰</span>
          </div>
        </div>
      </div>
    </section>

    <!-- é—œå¡å€ï¼ˆ5 å¼µå¡ç‰‡ï¼‰ -->
    <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <div id="cards" class="contents"></div>
    </section>
  </main>

  <!-- è¡“èª Modal -->
  <div id="glossaryModal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="modal-header">
        <h3 class="font-bold" id="glossaryTitle">èªªæ˜è¡“èª</h3>
        <span class="close-x" onclick="closeGlossary()">âœ–</span>
      </div>
      <div class="modal-body p-4">
        <p id="glossaryBody" class="text-gray-800 leading-7"></p>
      </div>
    </div>
  </div>

  <!-- å½±ç‰‡ Modal -->
  <div id="videoModal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="modal-header">
        <h3 class="font-bold" id="videoTitle">å­¸ç¿’è³‡æº</h3>
        <span class="close-x" onclick="closeVideo()">âœ–</span>
      </div>
      <div class="modal-body">
        <div class="aspect-video w-full">
          <iframe id="videoFrame" class="w-full h-[60vh]" src="" title="YouTube video" frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </div>
      </div>
    </div>
  </div>

  <!-- æ’è¡Œæ¦œ Modal -->
  <div id="leaderboardModal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="modal-header">
        <h3 class="font-bold">æ’è¡Œæ¦œï¼ˆæœ¬æ©Ÿï¼‰</h3>
        <span class="close-x" onclick="closeLeaderboard()">âœ–</span>
      </div>
      <div class="modal-body p-4">
        <table>
          <thead><tr><th>å­¸è™Ÿ</th><th>å§“å</th><th>å®Œæˆé—œå¡</th><th>å®Œæˆç‡</th><th>æœ€å¾Œæ›´æ–°</th><th>é€šé—œç¸½æ™‚é–“</th></tr></thead>
          <tbody id="leaderboardBody"></tbody>
        </table>
        <p class="text-xs text-gray-500 mt-2">*æ­¤æ’è¡Œæ¦œç´€éŒ„æ–¼æœ¬è£ç½®çš„ç€è¦½å™¨ LocalStorageã€‚</p>
      </div>
    </div>
  </div>

  <script>
    // ===== å¸¸é‡è¨­å®šï¼ˆé‡å° 5 é—œï¼‰ =====
    const TOTAL = 5;
    const PASSWORD = "888";
    let currentStudent = null;
    let teacherMode = false;

    // Glossaryï¼ˆæ²¿ç”¨ä½ åŸå§‹ç¾½çƒäº”é—œå…§å®¹ï¼‰
    const GLOSSARY = {
      'å¾Œå ´é«˜é çƒ': 'é«˜é çƒæ˜¯å¾å¾Œå ´å°‡çƒé«˜å¼§åº¦æ‰“å‘å°æ–¹å¾Œå ´çš„åŸºæœ¬æŠ€è¡“ã€‚é‡é»æ˜¯å´èº«å¼•æ‹ã€æ“Šçƒé»åœ¨èº«é«”å‰ä¸Šæ–¹ï¼Œå‡ºæ‹æ™‚é…åˆèº«é«”è½‰å‹•ï¼Œæƒ³åƒæŠŠçƒã€Œé€ä¸Šå»ã€é€åˆ°é æ–¹ã€ã€‚',
      'ç¶²å‰æ”¾çƒ': 'æ”¾å°çƒéœ€è¦ç´°è†©æ‰‹æ„Ÿã€‚æ‹é¢è¦ç©©ã€åŠ›é‡å°è€Œé€£çºŒï¼Œè®“çƒè²¼ç¶²ä¸‹å¢œã€‚æ“Šçƒé»åœ¨èƒ¸å£åˆ°è‚©è†€ä¹‹é–“ã€é è¿‘ç¶²å¸¶ä½ç½®ã€‚',
      'æ®ºçƒç·´ç¿’': 'æ®ºçƒæ˜¯å‘ä¸‹çš„é€²æ”»çƒã€‚æŠ¬è‚˜å¼•æ‹ã€èº«é«”å‘å‰ä¸Šæ–¹å»¶ä¼¸ï¼Œæ“Šçƒé»åœ¨æœ€é«˜é»ç¨å‰æ–¹ï¼Œè½åœ°è¦æœ‰ç·©è¡ã€‚å…ˆæ±‚ç©©å®šèˆ‡è½é»ï¼Œå†è¿½æ±‚åŠ›é‡ã€‚',
      'åŸºç¤å°æ‰“': 'å¼·èª¿ç¯€å¥èˆ‡ç©©å®šã€‚ç”¨ä¸ƒæˆåŠŸåŠ›ï¼Œçƒéä¸­ç·šå°±å›ï¼Œå°ˆæ³¨æ­¥ä¼åˆ°ä½ã€æ‹é¢ç©©ã€è½é»æ¸…æ¥šï¼Œå¯å…ˆå»ºç«‹ã€Œä¸€é«˜ä¸€å¹³ã€çš„ç¯€å¥ã€‚',
      'ç±³å­—æ­¥æ³•': 'æ¨¡æ“¬å…«æ–¹å‘ç§»å‹•ï¼ˆå‰ã€å¾Œã€å·¦ã€å³èˆ‡å››å€‹æ–œç·šï¼‰ã€‚é—œéµæ˜¯èµ·å‹•å¿«ã€æœ€å¾Œå…©æ­¥å°ç¢æ­¥èª¿æ•´ã€å›ä¸­ç«‹ä½æ™‚é‡å¿ƒåœ¨å‰è…³æŒã€‚'
    };

    // é—œå¡è³‡æ–™ï¼ˆå°æ‡‰ä½ äº”é—œï¼‰ â€” å·²ä¾ç…§ä½ æä¾›çš„å­¸ç¿’è³‡æºç¶²å€è¨­å®š
    const CHALLENGES = [
      {title:'å¾Œå ´é«˜é çƒ', goal:'å°‡çƒé«˜å¼§åº¦é€åˆ°å°æ–¹å¾Œå ´ã€‚', method:'èˆ‡æ­æª”ç«™åœ¨åº•ç·šï¼Œé€£çºŒ 5 æ¬¡æˆåŠŸæ‰“åˆ°å¾Œå ´å€åŸŸã€‚', video:'https://www.youtube.com/watch?v=CJXAXS82m5M'},
      {title:'ç¶²å‰æ”¾çƒ', goal:'æ§åˆ¶è¼•æŸ”éç¶²èˆ‡è½é»ã€‚', method:'åœ¨ç¶²å‰äº’ç›¸æ”¾å°çƒï¼Œé€£çºŒ 5 æ¬¡è½åœ¨ç¶²å‰ 1 å…¬å°ºå…§ã€‚', video:'https://www.youtube.com/watch?v=dR-NXBW2m5c'},
      {title:'æ®ºçƒç·´ç¿’', goal:'å­¸ç¿’å‘ä¸‹ç™¼åŠ›èˆ‡æ“Šçƒå‹•ä½œã€‚', method:'æ­æª”æ‹‹çƒåˆ°é ­é ‚ä¸Šæ–¹ï¼Œé€£çºŒ 3 æ¬¡å°‡çƒå‘ä¸‹æ‰“å…¥å°é¢å ´åœ°ã€‚', video:'https://www.youtube.com/watch?v=lZSFU_OpbCw'},
      {title:'åŸºç¤å°æ‰“', goal:'å»ºç«‹å›æ“Šç©©å®šåº¦èˆ‡å”èª¿æ€§ã€‚', method:'ä»¥è¼•é¬†åŠ›é“ä¾†å›å°æ‰“ï¼Œé€£çºŒ 10 æ¬¡ä¸è½åœ°ã€‚', video:'https://www.youtube.com/watch?v=3A22dThPUT0'},
      {title:'ç±³å­—æ­¥æ³•', goal:'ç†Ÿæ‚‰å…¨å ´å…«æ–¹å‘ç§»å‹•ã€‚', method:'ç”±ä¸­å¿ƒä¾åºç§»å‹•è‡³å…«å€‹æ–¹å‘ä¸¦å›ä¸­å¿ƒï¼Œæ–¼ 60 ç§’å…§å®Œæˆä¸€å¾ªç’°ã€‚', video:'https://www.youtube.com/watch?v=b0ZXWXMsVDM'}
    ];

    // ===== å°å·¥å…· =====
    const qs = (sel) => document.querySelector(sel);
    const nowISO = () => new Date().toISOString();
    function keyFor(student) { return `badminton_${student}`; }
    function getProgress(student) { return JSON.parse(localStorage.getItem(keyFor(student)) || '{}'); }
    function setProgress(student, obj) { localStorage.setItem(keyFor(student), JSON.stringify(obj)); }
    function beep() { const ctx = new (window.AudioContext||window.webkitAudioContext)(); const o = ctx.createOscillator(); const g = ctx.createGain(); o.type='triangle'; o.frequency.value=880; o.connect(g); g.connect(ctx.destination); g.gain.setValueAtTime(0.0001, ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.35, ctx.currentTime + 0.01); g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.32); o.start(); o.stop(ctx.currentTime + 0.33); }

    // ===== ç™»å…¥ / æ¨¡å¼ =====
    function login() {
      const id = qs('#studentId').value.trim();
      const name = qs('#studentName').value.trim();
      if(!id || !name) return alert('è«‹è¼¸å…¥å­¸è™Ÿèˆ‡å§“å');
      currentStudent = `${id}_${name}`;
      const p = getProgress(currentStudent);
      if(!p._meta) p._meta = { createdAt: nowISO(), lastUpdatedAt: nowISO(), wrongPassword: {}, firstFinishAt: null };
      setProgress(currentStudent, p);
      qs('#helloText').textContent = `Hiï¼Œ${name}`;
      qs('#loginSection').classList.add('hidden');
      qs('#app').classList.remove('hidden');
      renderCards(); loadStamps(); updateOverall();
      qs('#modePill2').classList.toggle('hidden', !teacherMode);
    }
    function logout(){ currentStudent=null; qs('#app').classList.add('hidden'); qs('#loginSection').classList.remove('hidden'); qs('#studentId').value=''; qs('#studentName').value=''; }
    function toggleTeacherMode(){ teacherMode=!teacherMode; qs('#modePill').classList.toggle('hidden', !teacherMode); if(currentStudent) qs('#modePill2').classList.toggle('hidden', !teacherMode); }

    // ===== é—œå¡æ¸²æŸ“ =====
    function cardTemplate(idx, c){
      return `
      <article class="card p-5 stamp-wrap relative">
        <svg id="stamp${idx}" class="stamp-svg" viewBox="0 0 120 120" aria-hidden="true">
          <circle cx="60" cy="60" r="46" fill="none" stroke="#ef4444" stroke-width="6"></circle>
          <text x="60" y="66" text-anchor="middle" font-size="26" font-weight="800" fill="#ef4444" style="letter-spacing:2px;">å®Œæˆ</text>
        </svg>
        <h3 class="text-xl font-bold text-[var(--headline)] mb-2">é—œå¡${idx}ï¼š${c.title}</h3>
        <p class="text-sm text-gray-700"><b>ç›®æ¨™ï¼š</b>${c.goal}</p>
        <p class="text-sm text-gray-700 mt-1"><b>åŸ·è¡Œæ–¹å¼ï¼š</b>${c.method}</p>
        <div class="mt-4 flex flex-wrap gap-2">
          <button class="btn btn-ghost" onclick="openGlossary('${c.title}')">âœ¨ èªªæ˜è¡“èª</button>
          <button class="btn btn-purple" onclick="openVideo(${idx}, '${c.title}', '${c.video}')">ğŸ“˜ å­¸ç¿’è³‡æº</button>
          <button class="btn btn-green" onclick="verify(${idx}, '${c.title}')">âœ… é—–é—œæˆåŠŸ</button>
        </div>
      </article>`;
    }
    function renderCards(){ qs('#cards').innerHTML = CHALLENGES.map((c,i)=>cardTemplate(i+1,c)).join(''); }

    // ===== å°ç« èˆ‡é©—è­‰ =====
    function loadStamps(){ const p=getProgress(currentStudent); for(let i=1;i<=TOTAL;i++){ if(p['challenge'+i]===true) qs('#stamp'+i)?.classList.add('stamp-bounce'); } }
    function markDone(i){ const el=qs('#stamp'+i); if(!el) return; el.classList.remove('stamp-bounce'); void el.offsetWidth; el.classList.add('stamp-bounce'); }
    function verify(i, title){
      const input = prompt(`è«‹è¼¸å…¥å¯†ç¢¼ä»¥ç¢ºèªã€Œé—œå¡${i}ï¼š${title}ã€éé—œï¼š`);
      const p = getProgress(currentStudent); if(!p._meta) p._meta={createdAt:nowISO(),lastUpdatedAt:nowISO(),wrongPassword:{},firstFinishAt:null};
      if(input===null) return;
      if(input===PASSWORD){ p['challenge'+i]=true; p._meta.lastUpdatedAt=nowISO(); const count=countCompleted(p); if(count===TOTAL && !p._meta.firstFinishAt) p._meta.firstFinishAt=nowISO(); setProgress(currentStudent,p); markDone(i); beep(); updateOverall(); alert(`ğŸ‰ æ­å–œï¼é—œå¡${i} å·²é€šéï¼`); }
      else { const wp=p._meta.wrongPassword||{}; wp[i]=(wp[i]||0)+1; p._meta.wrongPassword=wp; p._meta.lastUpdatedAt=nowISO(); setProgress(currentStudent,p); alert(wp[i]>=3?'â— å·²éŒ¯èª¤è¼¸å…¥ 3 æ¬¡ï¼Œè«‹ç¢ºèªæ˜¯å¦å®Œæˆä»»å‹™å†å˜—è©¦ã€‚':'âŒ å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹å†è©¦ä¸€æ¬¡ã€‚'); }
    }

    // ===== é€²åº¦ + çå‹µ =====
    let overallChart;
    function countCompleted(p){ return Object.keys(p).filter(k=>k.startsWith('challenge') && p[k]===true).length; }
    function updateOverall(){
      const p=getProgress(currentStudent); const done=countCompleted(p); const percent=Math.round(done/TOTAL*100);
      qs('#overallText').textContent = `å·²å®Œæˆ ${done}/${TOTAL} (${percent}%)`;
      qs('#badge3').classList.toggle('hidden', done<3);
      qs('#badge4').classList.toggle('hidden', done<4);
      qs('#badge5').classList.toggle('hidden', done<5);
      const ctx=document.getElementById('overallChart').getContext('2d');
      if(!overallChart){ overallChart=new Chart(ctx,{ type:'doughnut', data:{ datasets:[{ data:[done, TOTAL-done], borderWidth:4 }]}, options:{ cutout:'75%', plugins:{ legend:{display:false}, tooltip:{enabled:false} } } }); }
      else { overallChart.data.datasets[0].data=[done, TOTAL-done]; overallChart.update(); }
      if(done===TOTAL) showTrophy(); else hideTrophy();
    }
    function showTrophy(){ document.getElementById('trophy').classList.add('show'); beep(); }
    function hideTrophy(){ document.getElementById('trophy').classList.remove('show'); }

    // ===== Modalï¼šGlossary / Video =====
    function openGlossary(title){ document.getElementById('glossaryTitle').textContent = `èªªæ˜è¡“èªï¼š${title}`; document.getElementById('glossaryBody').textContent = GLOSSARY[title] || 'ï¼ˆå°šç„¡èªªæ˜ï¼‰'; document.getElementById('glossaryModal').classList.add('show'); }
    function closeGlossary(){ document.getElementById('glossaryModal').classList.remove('show'); }
    function openVideo(i,title,url){ document.getElementById('videoTitle').textContent = `å­¸ç¿’è³‡æºï¼šé—œå¡${i}ã€Œ${title}ã€`; const src = url.includes('embed')?url:url.replace('watch?v=','embed/'); document.getElementById('videoFrame').src = src+'?autoplay=1&rel=0'; document.getElementById('videoModal').classList.add('show'); }
    function closeVideo(){ document.getElementById('videoFrame').src=''; document.getElementById('videoModal').classList.remove('show'); }

    // ===== æ’è¡Œæ¦œï¼ˆæœ¬æ©Ÿï¼‰ =====
    function openLeaderboard(){ const body=document.getElementById('leaderboardBody'); body.innerHTML=''; for(let i=0;i<localStorage.length;i++){ const key=localStorage.key(i); if(!key.startsWith('badminton_')) continue; const who=key.replace('badminton_',''); const [sid,name]=who.split('_'); const p=JSON.parse(localStorage.getItem(key)||'{}'); const done=countCompleted(p); const percent=Math.round(done/TOTAL*100); const meta=p._meta||{}; const last=meta.lastUpdatedAt?new Date(meta.lastUpdatedAt).toLocaleString():'-'; let totalTime='-'; if(meta.firstFinishAt && meta.createdAt){ const t=(new Date(meta.firstFinishAt)-new Date(meta.createdAt))/1000; totalTime=`${Math.floor(t/60)}åˆ†${Math.floor(t%60)}ç§’`; } body.insertAdjacentHTML('beforeend',`<tr><td>${sid}</td><td>${name}</td><td>${done}/${TOTAL}</td><td>${percent}%</td><td>${last}</td><td>${totalTime}</td></tr>`); } document.getElementById('leaderboardModal').classList.add('show'); }
    function closeLeaderboard(){ document.getElementById('leaderboardModal').classList.remove('show'); }
  </script>
</body>
</html>
